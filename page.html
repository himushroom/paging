<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>新闻页</title>
    <style>
    body,html {
        margin: 0;
        padding: 0;
    }

    section{
    	width: 600px;
    	margin: 40px auto;
    	padding: 20px 50px;
    	background: rgba(195, 191, 172, 0.498039);
    }
    
    h2 {
        text-align: center;
    }

    section>p {
        text-align: right;
        margin: auto;
    }
    
    .box {
        width: 600px;
        height: 720px;
        margin: 20px auto;
        overflow: hidden;
    }
    .page {
		line-height: 36px !important;
		font: normal 16px "Microsoft YaHei", "微软雅黑", sans-serif;
		color: #515151;
		width: 100%;
    }
    .page img {
        width: 100%;
    }
    .page p{
    	margin: 0;
    	padding: 0;
    }
    
    .buttons {
        margin: 20px auto 30px;
        text-align: center;
    }
    
    .buttons span,
    .buttons a {
        padding: 2px 8px;
        outline: none;
        cursor: pointer;
        border: 1px solid #ccc;
        border-radius: 3px;
        color: #515151;
        text-decoration: none;
    }
    
    .buttons span.active,
    .buttons span:hover,
    .buttons a:not(.disable):hover {
        background: #515151;
        color: #fff;
    }
    
    .buttons a.disable,
    .buttons span.active {
        cursor: text;
    }
    
    .buttons a.disable {
        border: 1px solid #dfdfdf;
        color: #bbb;
    }
    
    .buttons .next {
        margin-left: 4px;
    }
    </style>
</head>

<body>
	<section>
		<h2>白夜行片段</h2>
    	<p>——此处仅作引用，版权归该文章作者所有</span>
        <div class="box">
        	<div class="page">
        		<p>百度百科：太阳到达最高点的时候，它的影子便消失了。刑警韩东秀（韩石圭饰）为了证实自己对一起已有定论的杀人案的猜想，致使自己的儿子意外身亡，从此变得意志消沉起来。14年后，一桩杀人案似乎和当年这起案件有着某种联系，当韩东秀再一次开始关注起当年一名被害人的儿子有汉（高洙饰）时，意外认识正在帮助财团老板调查未婚妻柳美皓（孙艺珍饰）的私家侦探，从私家侦探那里得知这名叫柳皓美的女人正是当年被认为是畏罪自杀的凶手的女儿李佳。当年这两个韩东秀曾经有怀疑过的小孩子如今长大成人，而且又同样因为凶杀案出现在他的周围。在韩东秀的追查过程中，他发现了当年凶杀案以及近期凶杀案的真相，而真相背后，却是一对永远不能在光天化日之下见面的苦恋情侣。
	            </p>
	            <p><img src="1.jpg" alt="1"></p>
	            <p>出了近铁布施站，沿着铁路径直向西。已经十月了，天气仍闷热难当，地面也很干燥。每当卡车疾驰而过，扬起的尘土极可能会让人又皱眉又揉眼睛。</p>
	            <p>笹垣润三的脚步说不上轻快。他今天本不必出勤。很久没休假了，还以为今天可以悠游地看点书。为了今天，他特地留着松本清张的新书没看。</p>
	            <p>柳美皓</p>
	            <p>演员 孙艺珍</p>
	            <p><img src="2.jpg" alt="2"></p>
	            <p>从小被自己的妈妈卖给有汉的爸爸，为了保护有汉杀死了自己的亲生妈妈，后来被姑姑抚养，长大后和财阀在一起。由于幼年时期的悲惨命运，她只能将悲伤埋藏在心底，但拥有矛盾性格的她也在不断伤害着别人。</p>
	            <p>公园出现在右边，大小足以容纳两场三垒棒球开打，丛林越野游戏、秋千、滑梯等常见的游乐设施一应俱全。这座公园是附近最大的一座，叫真澄公园。</p>
	            <p>公园后面有一栋兴建中的七层建筑，乍看之下平淡无奇，但笹垣知道里面几乎空无一物。在调到大阪警察本部之前，他就待在管辖这一带的西布施分局。</p>
	            <p>看热闹的人动作很快，已经聚集在大楼前，停在那里的好几辆警车几乎被看客团团围住。</p>
	            <p>笹垣没有直接走向大楼，而是在公园前右转。转角数来第五家店挂着“烤乌贼饼”的招牌，店面仅一叠大小。烤乌贼饼的台子面向马路，后面坐着一个五十岁左右的胖女人，正在看报。店内看来是卖零食的，但没见到小孩子的身影。</p>
	            <p>“老板娘，给我烤一片。”笹垣出声招呼。</p>
	            <p>中年妇人急忙合起报纸。“好，来了来了。”</p>
	            <p>妇人站起身，把报纸放在椅子上。笹垣衔了根和平牌香烟，擦火柴点着，瞄了一下那份报纸，看到“厚生省公布市场海鲜汞含量检查结果”的标题，旁边以小字写着“大量食用鱼类亦不致达到该含量”。</p>
	            <p>三月时，法院对熊本水俣病作出判决，与新泻水俣病、四日市哮喘病、痛痛病合称四大公害的审判，就此全数结案。结果，每一桩诉讼均是原告胜诉，这使得民众莫不对公害戒慎恐惧。尤其是日常食用的鱼类遭汞或PCB（多氯联苯）污染疑虑未消，使大众人心惶惶。</p>
	            <p>乌贼不会有问题吧？笹垣看着报纸想。</p>
	            <p><img src="3.jpg" alt="3"></p>
	            <p>烤乌贼饼的两片铁板由铰链连在一起，夹住裹了面粉和蛋汁的乌贼，再利用铁板加热。烧烤乌贼的味道激起了食欲。</p>
	            <p><img src="4.jpg" alt="4"></p>
	            <p>充分加热后，老板娘打开铁板，又圆又扁的脆饼黏在其中一片铁板上。她涂上薄薄的酱汁，对折，再以咖啡色纸包起来，说声“好了”，把饼递给笹垣。</p>
	            <p><img src="5.jpeg" alt="5"></p>
	            <p>笹垣看了看写着“烤乌贼饼四十元”的牌子，付了钱。老板娘亲切地说：“多谢。”然后拿起报纸，坐回椅子。</p>
	            <p>笹垣正要离开，一个中年女子在店门口停下脚步，向老板娘打招呼。她手上提着购物篮，看样子是附近的家庭主妇。“那边好像很热闹，是不是出了什么事呀？”她指着大楼问。</p>
            </div>
        </div>
        <div class="buttons">
            <a href="javascript:void(0)" class="prev disable">上一页</a>
            <span class="active">1</span>
            <a href="javascript:void(0)" class="next">下一页</a>
        </div>
	</section>
    	<script src='jquery-3.1.1.min.js'></script>
        <script>
        var buttons = $('.buttons'),
            prevButton = $('.prev'),
            nextButton = $('.next');
        window.onload = function() {
            //设置分页
            var pages = $('.box'),
                page = $('.page'),
                boxH = pages[0].clientHeight, //界面显示出来的高度
                pageH = pages[0].scrollHeight, //文章实际高度
                minH = 36, //一行文字的最小高度
                allIndex = Math.ceil(pageH / (boxH)); //总页数

            // 有图片的情况
            var pageImg = page.find('img');
            var singleHeight = [],
                singleOffset = [],
                averH;
            if (pageImg) {
                var offsetY = 0;
                for (var h = 0; h < allIndex; h++) {
                    averH = setHeight(boxH, pageImg, pages, offsetY);
                    singleHeight.push(averH);
                    singleOffset.push(offsetY);
                    offsetY += averH;
                    if (offsetY > pageH) {
                        pages.css('height', singleHeight[0]);
                    }
                }
            }

            var newIndex = 1,
                allH = 0;
            for (var w = 0; w < singleHeight.length; w++) {
                allH += singleHeight[w];
                if (allH > pageH) {
                    newIndex = w + 1;
                    break
                }
            }
            if (newIndex > 1) {
                for (var m = 2; m <= newIndex; m++) {
                    $(nextButton).before($('<span>' + m + '</span>'))
                }
            }
            judgeIndex(nextButton, prevButton);
            var button = buttons.find('span'),
                pageTop = $('section').offset().top,
                allPage = $('html,body');
            // 选择页码
            $(button).click(function() {
                if ($(this).hasClass('active')) {
                    return
                }
                var nowNumber = $(this).html();
                // 更新中间页码的显示状态
                $(button).removeClass('active');
                $(this).addClass('active');
                //更新翻页状态
                judgeIndex(nextButton, prevButton);

                //切换文章
                pages.css('height', singleHeight[nowNumber - 1]);
                page.css('margin-top', -singleOffset[nowNumber - 1])

                //页面滚动到顶部
                allPage.animate({
                    scrollTop: pageTop
                }, 500)
            });

            // 下一页
            $(nextButton).click(function() {
                if ($('.next').hasClass('disable')) {
                    return
                }
                var prevNumber = parseInt($('.buttons span.active').html());
                // 给下一个页码添加active样式
                $(button).removeClass('active');
                $(button).eq(prevNumber).addClass('active');
                //更新翻页状态
                judgeIndex(nextButton, prevButton);

                //切换文章
                pages.css('height', singleHeight[prevNumber]);
                page.css('margin-top', -singleOffset[prevNumber])

                //页面滚动到顶部
                allPage.animate({
                    scrollTop: pageTop
                }, 500)
            });

            // 上一页
            $(prevButton).click(function() {
                if ($('.prev').hasClass('disable')) {
                    return
                }
                var nextNumber = parseInt($('.buttons span.active').html());
                // 给下一个页码添加active样式
                $(button).removeClass('active');
                $(button).eq(nextNumber - 2).addClass('active');
                //更新翻页状态
                judgeIndex(nextButton, prevButton)

                //切换文章
                pages.css('height', singleHeight[nextNumber - 2]);
                page.css('margin-top', -singleOffset[nextNumber - 2])

                //页面滚动到顶部
                allPage.animate({
                    scrollTop: pageTop
                }, 500)
            });
        };

        function judgeIndex(nextButton, prevButton) {
            // 判断上一页按钮的显示状态
            if (nextButton.prev().hasClass('active')) {
                nextButton.addClass('disable');
            } else if (nextButton.hasClass('disable')) {
                nextButton.removeClass('disable');
            }
            // 判断下一页按钮的显示状态
            if (prevButton.next().hasClass('active')) {
                prevButton.addClass('disable');
            } else if (prevButton.hasClass('disable')) {
                prevButton.removeClass('disable');
            }
        }

        function setHeight(boxH, pageImg, pages, offsetY) {
            var averH = boxH,
                minH = 36;
            for (var i = 0; i < pageImg.length; i++) {
                // 单张图片距离文章顶部的距离
                var imgTop = pageImg[i].offsetTop - pages[0].offsetTop - offsetY;
                console.log('imgTop=' + imgTop);
                // 单张图片外包裹的父元素的高度
                var pHeight = pageImg[i].parentNode.clientHeight;
                // 如果图片高度小于盒子高度并且图片高度+图片到盒子顶部的距离小于父元素高度时将这张图片的高度+图片到盒子顶部的距离赋值给盒子
                if (imgTop >= 0 && imgTop < boxH && imgTop + pHeight > boxH) {
                    averH = imgTop + pHeight + minH;
                } else if (imgTop >= 0 && imgTop < boxH && imgTop + pHeight < boxH) { // 如果图片高度小于盒子高度并且图片高度+图片到盒子顶部的距离均小于盒子总高度时,将图片高度-图片按单行高度约分的方法赋值给盒子
                    //平均高度
                    averH += pHeight - Math.round(pHeight / minH) * minH + minH;
                }
            }
            return averH
        }
        </script>
</body>

</html>
